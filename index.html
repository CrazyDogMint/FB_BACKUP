<!DOCTYPE HTML>
<html ng-app="myApp" ng-controller="main">
<head>
	<meta charset="utf-8">
	<title ng-bind="ret.info.name">Backup Facebook</title>
	<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.min.js"></script>
	<script>
		var node = {};
		var type = "page";
		var tab = "posts";
	</script>
	<script src="data/js/page_359985940825230_info.js"></script>
	<script src="data/js/page_359985940825230_albums.js"></script>
	<script src="data/js/page_359985940825230_photos.js"></script>
	<script src="data/js/page_359985940825230_posts.js"></script>
	<script src="data/js/page_359985940825230_comments.js"></script>
	<script src="js/controller.js"></script>
	<link rel="stylesheet" href="styles/style.css">
	<base target="_blank">

	<script type="text/ng-template" id="templateMetadata">
		<li title="ID">{{node._id}}</li>
		<li ng-repeat="time in [node.created_time, node.backdated_time]"
			ng-if="time" ng-include="'templateTime'"
		></li>
		<li ng-if="node.from">Author: <a href="{{ret.createLink(node.from.id)}}">{{node.from.name}}</a></li>
		<li ng-if="node.like_count">{{node.like_count|number}} likes</li>
		<li ng-if="node.privacy">Viewable to {{node.privacy.value || node.privacy}}</li>
		<li ng-if="node.type">Type: {{node.type}}</li>
	</script>

	<script type="text/ng-template" id="templateGeneral">
		<header>
			<img ng-if="node.picture"
				ng-src="{{node.picture.data.url||node.picture}}"
			>
			<h3>{{node.name}}</h3>
		</header>
		<ul class="metadata" ng-include="'templateMetadata'"></ul>
		<nav>
			<ul>
				<li ng-if="node.link" title="Original webpage of this on facebook"><a href="{{node.link}}">Facebook</a></li>
				<li ng-if="node.event">Event: <a href="{{ret.createLink(node.event.id)}}">node.event.name</a></li>
			</ul>
		</nav>
		<address ng-if="node.place" ng-include="'templatePlace'" onload="place=node.place"></address>
		<section class="description">{{node.description}}</section>

		<!-- Photos for album -->
		<details ng-if="node.photos.length">
			<summary>{{node.photos.length |number}} photos</summary>
			<article ng-repeat="node in node.photos track by node._id" ng-include="'templatePhoto'"></article>
		</details>
	</script>

	<script type="text/ng-template" id="templatePost">
		<p ng-if="node.story" class="story">{{node.story}}</p>
		<ul class="metadata" ng-include="'templateMetadata'"></ul>
		<div ng-if="node.link">
			<!--
				While posting a photo, `attachments.data[0].subattachments.data[0].description`
				and `description` would have the same value.
				Therefore, using `attachments` (and `templateAttachment`) here
				may not be a good idea.
			-->
			<section ng-if="node.child_attachments" class="attachments">
				<h4><a href="{{node.link}}">{{node.child_attachments[0].name}}</a></h4>
				<p class="description">{{node.child_attachments[0].description}}</p>
				<img ng-repeat="ca in node.child_attachments track by $index" ng-src="{{ca.picture}}">
				<!--h4><a href="{{node.link}}">{{node.attachments.data[0].subattachments.data[0].title}}</a></h4>
				<p class="description">{{node.attachments.data[0].subattachments.data[0].description}}</p>
				<img ng-repeat="atta in node.attachments.data[0].subattachments.data track by $index" ng-src="attr.media.src"-->
			</section>
			<section ng-if="!node.child_attachments" class="table attachment">
				<a class="tableCell" href="{{node.link}}"
					ng-if="node.full_picture||node.picture"
				><img ng-src="{{node.full_picture||node.picture}}"></a>
				<div class="tableCell">
					<h4 ng-if="node.name"><a href="{{node.link}}">{{node.name}}</a></h4>
					<p class="description">{{node.description}}</p>
				</div>
			</section>
		</div>
		
		<nav>
			<ul>
				<li title="Original webpage of this on facebook"><a href="{{ret.createLink(node._id)}}">Facebook</a></li>
				<li ng-repeat="a in node.actions track by $index" ng-if="['Comment','Like','Share'].indexOf(a.name)==-1">
					<a href="{{a.link}}">{{a.name}}</a>
				</li>
				<li ng-if="node.parent_id">
					<a href="{{ret.createLink(node.parent_id,'posts')}}">Parent Post</a>
				</li>
				<li ng-if="node.event">Event: <a href="{{ret.createLink(node.event.id)}}">node.event.name</a></li>
			</ul>
		</nav>
		<address ng-if="node.place" ng-include="'templatePlace'" onload="place=node.place"></address>


		<section class="message">{{node.message}}</section>
		<ul class="tags">
			<li ng-repeat="tag in ([].concat(
					node.story_tags, node.message_tags, node.with_tags
				)|unique) track by tag.id"
				ng-if="tag.name"
			><a href="{{ret.createLink(tag.id)}}">{{tag.name}}</a>
			</li>
		</ul>
	</script>

	<script type="text/ng-template" id="templateComment">
		<a href="{{ret.createLink(node.from.id)}}">{{node.from.name}}</a>
		<ul class="metadata" ng-include="'templateMetadata'"></ul>
		<div class="message" ng-if="node.message">{{node.message}}</div>

		<section ng-repeat="atta in [node.attachment] track by $index"
			ng-include="'templateAttachment'" class="table attachment"
		></section>
		<div class="cc" ng-include="'templateComment'"
			ng-repeat="node in (node.comments |orderBy: 'created_time') track by node._id"
		></div>
	</script>

	<script type="text/ng-template" id="templateAttachment">
		<!-- Used only by `templateComment`. -->
		<a class="tableCell" href="{{atta.url}}"
		><img ng-src="{{atta.media.image.src}}" title="{{atta.type}}"></a>
		<div class="tableCell">
			<h4 ng-if="atta.title"><a href="{{atta.url}}">{{atta.title}}</a></h4>
			<p class="description">{{atta.description}}</p>
		</div>
	</script>

	<script type="text/ng-template" id="templatePhoto">
		<div class="table" style="width: 100%;">
			<a class="tableCell"
				href="data/photos/album_{{node.album.id}}/{{node._id}}.jpg"
			><img ng-src="{{node.picture}}"></a>
			<p class="tableCell description">{{node.name}}</p>
			<div class="tableCell"><ul class="metadata" ng-include="'templateMetadata'"></ul></div>
		</div>
		<nav>
			<ul>
				<li><a href="{{node.link}}">Facebook</a></li>
				<li><a title="{{node.album.name}}" href="{{ret.createLink(node.album.id)}}">Album</a></li>
			</ul>
		</nav>
		<ul class="tags">
			<li ng-repeat="tag in node.name_tags track by tag.id">
				<a href="{{ret.createLink(tag.id)}}">{{tag.name}}</a>
			</li>
			<li ng-if="node.place"><address ng-include="'templatePlace'" onload="place=node.place"></address></li>
		</ul>
	</script>

	<script type="text/ng-template" id="templateEvent">
		<h3>{{node.name}}</h3>
		<div class="metadata">
			<ul>
				<li>
					<a class="time_container" name="{{node._id}}" href="{{ret.createLink(node._id)}}">
						<time datetime="{{node.updated_time}}"
							title="Last update time" class="updated_time"
						>{{node.updated_time | date: 'yyyy-MM-dd HH:mm:ss'}}
						</time>
					</a>
				</li>
				<li ng-if="node.category">Category: {{node.type}}</li>
				<li ng-if="node.type">Type: {{node.type}}</li>
				<li ng-if="node.timezone">Timezone: {{node.timezone}}</li>
				<!--li title="Statistics">
					<dl>
						<dt>Attending</dt><dd>{{node.attending_count}}</dd>
						<dt>Declined</dt><dd>{{node.declined_count}}</dd>
						<dt>Maybe</dt><dd>{{node.maybe_count}}</dd>
						<dt>No replay</dt><dd>{{node.noreply_count}}</dd>
						<dt>Interested in</dt><dd>{{node.interested_count}}</dd>
					</dl>
				</li-->
			</ul>
		</div>
		<nav>
			<ul>
				<li ng-if="node.ticket_uri">
					<a href="{{node.ticket_uri}}">Buy a ticket</a>
				</li>
				<li>Owner: <a href="{{ret.createLink(node.owner.id)}}">{{node.owner.name}}</a></li>
				<li ng-if="node.parent_group">
					Parent:
					<a href="{{ret.createLink(node.parent_group.id)}}"
					>{{node.parent_group.name}}</a>
				</li>
			</ul>
		</nav>
		<dl>
			<dt>From</dt>
			<dd>
				<time datetime="{{node.start_time}}">
					{{node.start_time|date:'yyyy-MM-dd (EEE) HH:mm'}}
				</time>
			</dd>
			<dt ng-if="node.end_time">To</dt>
			<dd ng-if="node.end_time">
				<time datetime="{{node.end_time}}">
					{{node.end_time|date:'yyyy-MM-dd (EEE) HH:mm'}}
				</time>
			</dd>
			<dt>Place</dt>
			<dd><address ng-include="'templatePlace'" onload="place=node.place"></address></dd>
		</dl>
		<details ng-if="node.description" class="description"
		><summary>Description</summary>{{node.description}}
		</details>
		<div>
			<h4>Statistics</h4>
			<dl>
				<dt>Attending</dt><dd>{{node.attending_count}}</dd>
				<dt>Declined</dt><dd>{{node.declined_count}}</dd>
				<dt>Maybe</dt><dd>{{node.maybe_count}}</dd>
				<dt>No replay</dt><dd>{{node.noreply_count}}</dd>
				<dt>Interested in</dt><dd>{{node.interested_count}}</dd>
			</dl>
		</div>
	</script>

	<script type="text/ng-template" id="templatePage">
		<header style="display: inline-block; width: 40%;">
			<a class="photo" href="{{node.link}}"><img ng-src="{{node.picture.data.url}}"></a>
			<div class="photo_side">
				<h3 class="photo_name"><a href="{{node.link}}">{{node.name}}</a></h3>
				{{node.category}}
			</div>
		</header>
		<details>
			<summary ng-click="ret.showDetails[node._id]=!ret.showDetails[node._id]">Details</summary>
			<nav>
				<ul>
					<li ng-if="node.cover"><a href="{{node.cover.source}}">Cover Photo</a></li>
					<li ng-if="node.website"><a href="{{node.website}}">Website</a></li>
					<li ng-if="node.featured_video">
						<a href="{{ret.createLink(node.featured_video.id)}}"
							title="{{node.featured_video.description}}"
						>Featured Video</a>
					</li>
					<li ng-if="node.best_page">
						<a title="The best available Page on Facebook for the concept represented by this Page."
							href="{{ret.createLink(node.best_page.id)}}"
						>{{node.best_page.name}}</a>
					</li>
				</ul>
			</nav>
			<p>{{node.likes|number}} people like this.</p>
			<p ng-if="node.were_here_count">{{node.were_here_count|number}} people were here.</p>
			<p>{{node.talking_about_count|number}} are talking about this.</p>
			<p ng-if="node.founded">Founded at <time>{{node.founded}}</time></p>
			<p ng-if="node.release_date">Released at <time>{{note.release_date}}</time></p>
			<p ng-if="node.start_info.date" title="start_info">
				{{node.start_info.type}}
				at
				<time>
					<span class="year">{{node.start_info.date.year}}</span
					><span class="month" ng-if="node.start_info.date.month">-{{node.start_info.date.month}}</span
					><span class="day" ng-if="node.start_info.date.day">-{{node.start_info.date.day}}</span>
				</time>
			</p>
			<section ng-repeat="field in ret.displaySet.page.block"
				ng-if="node[field]" class="description"
			><h4>{{field|capitalize}}</h4>{{node[field]}}</section>

			<section ng-repeat="field in ret.displaySet.page.complicated"
				ng-if="node[field]" class="dlWrapper"
			>
				<h4>{{field|capitalize}}</h4>
				<dl ng-repeat="(k,v) in node[field]">
					<dt>{{k}}</dt><dd>{{v}}</dd>
				</dl>
			</section>
			<div class="dlWrapper">
				<dl ng-repeat="field in ret.displaySet.page.inline" ng-if="node[field]">
					<dt>{{field|capitalize}}</dt><dd class="description">{{node[field]}}</dd>
				</dl>
				<dl ng-repeat="field in ret.displaySet.page.list" ng-if="node[field]">
					<dt>{{field|capitalize}}</dt>
					<dd><ul><li ng-repeat="ele in node[field]">{{ele}}</li></ul></dd>
				</dl>
				<dl ng-repeat="field in ret.displaySet.page.complicatedList" ng-if="node[field]">
					<dt>{{field|capitalize}}</dt>
					<dd>
						<div class="tableRow">
							<div ng-repeat="(k,v) in node[field][0]" class="tableCell">{{k}}</div>
						</div>
						<div ng-repeat="ele in node[field] track by $index" class="tableRow">
							<div ng-repeat="(k,v) in ele" class="tableCell description"
								title="{{k}}"
							>{{v}}</div>
						</div>
					</dd>
				</dl>

				<dl ng-if="node.category_list">
					<dt>Sub-categories</dt>
					<dd><ul><li ng-repeat="c in node.category_list track by $index">{{c.name}}</li></ul></dd>
				</dl>
				<dl ng-repeat="field in ret.displaySet.page.unknown" ng-if="node[field]">
					<dt>{{field}}</dt>
					<dd style="white-space: pre-wrap;">{{node[field]}}</dd>
				</dl>
			</div>
			<!--details class="rawdata"><summary>JSON</summary>{{node|json}}</details-->
		</details>
	</script>

	<script type="text/ng-template" id="templatePlace">
		<a href="{{ret.createLink(place.id)}}">{{place.name}}</a>
		<span ng-if="place.location.street">(<a href="https://www.google.com/maps?q={{
			place.location.street
			+ (place.location.city ? (',+' + place.location.city) : '')
			+ (place.location.country ? (',+' + place.location.country) : '')
		}}">{{
			place.location.street
			+ (place.location.city ? (',+' + place.location.city) : '')
			+ (place.location.country ? (',+' + place.location.country) : '')
		}}</a>)</span>
	</script>

	<script type="text/ng-template" id="templateTime">
		<time datetime="{{time}}">{{time |date: 'yyyy-MM-dd HH:mm'}}</time>
	</script>
</head>
<body>
	<div id="wrapper">
		<h1 ng-bind="ret.info.name"></h1>
		<p class="about" ng-if="ret.info.about" ng-bind="ret.info.about"></p>
		<p class="about" ng-if="ret.info.bio" ng-bind="ret.info.bio"></p>
		<blockquote class="about" ng-if="!ret.info.about && !ret.info.bio" ng-bind="ret.info.quotes"></blockquote>
		<nav>
			<ul>
				<li ng-click="ret.tab='info'" ng-class="(ret.tab=='info')?'focus':''"
				>Info</li>
				<li ng-repeat="t in ret.tabs" ng-if="ret[t].length"
					ng-click="ret.tab=t" ng-class="(ret.tab==t)?'focus':''"
				>{{t|capitalize}} <span class="count">({{ret[t].length}})</span></li>
				<li><a href="{{ret.info.link||ret.createLink(ret.info.id)}}">Facebook</a></li>
			</ul>
		</nav>
		<section id="info" ng-show="ret.tab=='info'">
			<h2>Info</h2>
			<div class="rawdata">{{ret.info|json}}</div>
		</section>
		<section ng-repeat="t in ret.tabs" ng-if="t!='info'" ng-show="ret.tab==t" id="{{t}}">
			<h2>{{t|capitalize}}</h2>
			<div ng-if="t=='feed'||t=='posts'||t=='comments'||t=='likes'">
				<label>
					Search:
					<input ng-model="ret.search[t]"
						ng-model-options="{debounce: 250}" placeholder="search text"
					>
				</label>
				<p ng-show="ret.search[t]">matched {{filtered.length}} {{t}}</p>
			</div>
			<div ng-if="t=='feed'||t=='posts'||t=='comments'">
				<nav ng-hide="ret.search[t]">
					<ul>
						<li ng-repeat="m in ret.months[t]"
							ng-click="ret.month[t] = m"
							ng-class="(ret.month[t] == m)?'focus':''"
						>{{m}}</li>
					</ul>
				</nav>
			</div>
			{{filtered.length}} {{t}}
			<article ng-repeat="node in filtered=(ret[t]|filter:(ret.search[t]?ret.search[t]:{created_time:ret.month[t]})) track by node._id">
				<div ng-include="(['posts','feed'].indexOf(t)>-1)?'templatePost':'templateGeneral'"></div>
				<details ng-if="node.comments.length">
					<summary title="newest: {{node.updated_time| date:'yyyy-MM-dd HH:mm'}}">
						{{node.comments.length|number}} comment(s)
					</summary>
					<section class="comment" ng-include="'templateComment'"
						ng-repeat="node in (node.comments |orderBy: 'created_time') track by node._id"
					></section>
				</details>
				<details class="rawdata"><summary>JSON</summary>{{node|json}}</details>
			</article>
		</section>
		<details class="rawdata" style="padding-bottom: 3em;"><summary>Debug</summary>{{ret|json}}</details>
		<footer>This is the footer of the page.</footer>
	</div>
</body>
</html>
